# 동네잡일 애플리케이션
![스크린샷 2021-11-28 오후 6 02 29](https://user-images.githubusercontent.com/76893270/143741136-08c76afb-7112-461e-927a-b99913d7d302.png)

---

<br/><br/>

## 📜 목차
* [소개](#-소개)
* [기능](#-기능)
* [구성](#-구성)
* [기술 스택](#-기술-스택)
* [고민거리](#-고민거리)
* [TODO](#-TODO)
* [기능 이미지로 보기](#-기능-이미지로-보기)

<br/><br/>

## 🗣 소개

#### 🏘 동네잡일

소소한 일상 얘기나 일손이 필요한 경우 게시글을 작성하여 내 주변 사람들에게 공유할 수 있는 서비스 입니다.


<br/><br/>

## 🧩 기능

| 분류 | 기능 | 분류 | 기능 |
| :---: | :---: | :---: | :---: |
| 유저 | 로그인 | 푸시알림 | 댓글 등록 푸시알림 |
| | 로그아웃 |  | 좋아요 푸시알림 |
| | 회원가입 | 신고 | 게시글 신고 |
| | 프로필 사진 수정 | | 유저 신고 |
| 게시글 | 게시글 작성| | 댓글 신고 | 
| | 게시글 상세 조회 | 마이페이지 | 게시글 조회 | 
| | 게시글 리스트 조회 | 검색어 | 게시글 제목or내용 검색어 조회 |  
| | 게시글 삭제 | | 게시글 해시태그 검색어 조회 |
| | 게시글 수정 | 
| | 게시글 좋아요 | 
| | 게시글 좋아요 취소 | 
| 댓글 | 댓글/대댓글 작성 | 
| | 댓글 상세 조회 | 
| | 댓글 리스트 조회 |
| | 댓글 수정 |
| | 댓글 삭제 | 








<br/><br/>

## 👉🏻 구성

![CI/CD](https://user-images.githubusercontent.com/76893270/142574951-9e825d87-ce6a-49d1-8013-ce9dd490e526.png)

<br/><br/>

## 🛠 기술 스택
![스크린샷 2021-11-26 오후 3 21 42](https://user-images.githubusercontent.com/76893270/143536139-a32ac665-5c0d-4aaa-9f51-28fa637298fc.png)

<br/><br/>

## 🤦 고민거리 
 # 1.epress에서 트랜잭션 관리하는 방법은?

  <클라이언트-요청>
  ![image](https://user-images.githubusercontent.com/76893270/142581494-10a20da0-b587-41d5-a1fd-ff8429873d9e.png)

 요청이 들어오는 라우터 별로 트랜잭션을 생성해서 기능을 동작시키고 마지막 클라이언트로 응답을 보낼 때 트랜잭션을 초기화 하는 식으로 개발을 진행하려 했으나 문제가 발생. 
 
 ### 방법 1
  - 요청이 들어올 때마다 wrap() 메소드 상단에서 트랜잭션을 생성 후 글로벌 변수에 담아 트랜잭션 처리를 진행 후 응답 성공/실패 부분에서 트랜잭션 커밋/롤백을 하도록 개발 
  
  **문제점 : api 호출이 한 번씩 들어오면 문제가 안되는데 클라이언트에서 동시에 api를 2개 이상 호출해버리면 트랜잭션이 하나로 덮어져버리는 문제가 발생..**
 
 ### 임시 해결 
  - 우선 임시로 wrap()에 들어올 때마다 트랜잭션을 생성후 생성된 트랜잭션을 request.transaction에 담아 각자의 api 기능들에서 사용할 수 있도록 변경  
  > 기능 적으로는 문제가 해결됐으나 개발자가 직접 Controller -> Repository -> ResponseSucceed(commit) 트랜잭션 이동 해줘야 하는 문제가 있음.
      
      
 # 2.로그 관리?
 ![image](https://user-images.githubusercontent.com/76893270/142726649-ea7059bd-6e9f-4146-a219-bd95483325e9.png)

 어느 정도 개발이 진행됐을 때 실제 운영 서버에 서버를 띄워 테스트를 진행을 했다. 회원가입을 하고 로그인을 하는 도중 갑자기 클라이언트 쪽에 문제가 발생했다. 클라이언트 로그를 확인하니 서버에서 
 데이터베이스 오류 메시지를 던져주고 있었다. 이전에는 로컬에서 console.log로 로그를 띄워 에러 내용을 확인할 수 있었지만 운영에서는 console.log를 확인할 수가 없는 상황이다. 
 
 ### 방법 1
  - 처음으로 고안해낸 방법으로는 winston 라이브러리를 사용하여, AWS S3에 로그를 저장하는 방법이다.  
  
 **문제점 : 로그 파일 내용을 이어 쓰기를 하려면 코드에서 파일 전체를 읽어들인 다음 내용을 써야 하는데 로그가 길어져 버리면 속도 문제가 발생될 여지가 있음..**
    
 ### 임시 해결
  - 다른 방법을 고민하던 도중 우연찮게 강의를 듣다가 sentry를 알게 되었다. 잠시 강의를 멈추고 sentry를 검색해 찾아본 결과 지금 로그 문제를 어느 정도 보완해줄수 있을거라 생각하고 바로 적용하였다.  
  - 에러가 발생했을 때에는 분석하기 쉽게 정말 세세하게 많은 정보들이 sentry에 저장되었다. 
    
  > 하지만 임시 해결이라 생각하는 이유는 에러 발생 시 로그는 완벽하게 저장되었지만, 추후에 성공 로그들과 비교해서 분석할 경우가 있을 거라 생각이 드는데 성공 로그는 어떻게 관리해야할 지 고민이다. 
  

<br/><br/>

## ✅ TODO

- [x] 관리자 페이지
  - [x] 데이터 조회
- [x] 팔로우
    - [x] 사용자 팔로우
    - [x] 사용자 언팔로우
    - [x] 사용자의 팔로워 리스트 조회
    - [x] 사용자의 팔로잉 리스트 조회


<br/><br/>

## 🧩 기능 이미지로 보기
[검색]
![image](https://user-images.githubusercontent.com/76893270/143752981-3110919a-66e9-49a4-91be-bfc4a70f8849.png)


[푸시알림]  [마이페이지] 
![스크린샷 2021-11-28 오후 6 14 28](https://user-images.githubusercontent.com/76893270/143749520-fc20c88d-76a2-405b-9a42-550a354a7cd6.png)  ![스크린샷 2021-11-28 오후 6 13 51](https://user-images.githubusercontent.com/76893270/143749578-7782ba55-345d-4ef5-8a0d-c97b829ef5b2.png)

[게시글] [댓글] 
![image](https://user-images.githubusercontent.com/76893270/143751918-a2bc8f94-3693-4ff8-93db-5cc20fd8c061.png)




---
